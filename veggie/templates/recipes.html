{% extends "base.html" %} 
{% block start %}

<div class="container mt-4">
    <!-- Username display -->
    <div class="welcome-banner mb-4">
        <h4 class="fw-bold">Add Skills/Items</h4>
        <p class="text-white mb-0">Welcome, {{request.user}}</p>
    </div>

    <!-- Add Recipe Form -->
    <div class="relative bg-gradient-to-r from-purple-500 via-indigo-500 to-pink-500 p-4 rounded-3xl shadow-lg">
        <div class="col-12 mx-auto card bg-white shadow-lg border-0 mb-4">
            <div class="card-body p-4">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <h4 class="card-title mb-4 fw-bold">Add New Skill/Item</h4>
    
                    <!-- Category Name Input -->
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Category Name</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16">
                                    <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                                </svg>
                            </span>
                            <input type="text" required name="recipe_name" class="form-control bg-light border-start-0" placeholder="Enter Category Name">
                        </div>
                    </div>
    
                    <!-- Description Input -->
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Description</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-card-text" viewBox="0 0 16 16">
                                    <path d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z"/>
                                    <path d="M3 5.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 8zm0 2.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                            </span>
                            <textarea name="recipe_des" class="form-control bg-light border-start-0" rows="3" required placeholder="Enter description"></textarea>
                        </div>
                    </div>
    
                    <!-- Image/Video Input -->
                    <div class="mb-4">
                        <label class="form-label small fw-bold">Image/Video</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                </svg>
                            </span>
                            <input name="recipe_image" type="file" class="form-control bg-light border-start-0" accept="image/*">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Main Category</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tag" viewBox="0 0 16 16">
                                    <path d="M6 4.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm-1 0a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0z"/>
                                    <path d="M2 1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 1 6.586V2a1 1 0 0 1 1-1zm0 5.586 7 7L13.586 9l-7-7H2v4.586z"/>
                                </svg>
                            </span>
                            <input type="text" required name="recipe_main" class="form-control bg-light border-start-0" placeholder="Enter Main Category">
                        </div>
                    </div>
    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-lg px-4">
                        
                        Add Post
                    </button>
                </form>
            </div>
        </div>
    </div>
    
<br><br>
   <!-- Search Bar -->
<div class="card shadow-sm border-0 mb-4" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);">
    <div class="card-body">
        <form class="d-flex gap-2">
            <div class="input-group">
                <span class="input-group-text bg-light border-end-0">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </span>
                <input type="search" name="search" class="form-control bg-light border-start-0" placeholder="Search..." value="{{ request.GET.search }}">
            </div>
            <button type="submit" class="btn btn-primary px-4">Search</button>
        </form>
    </div>
</div>

<br>

<!-- Recipes Table -->
<div class="card shadow-sm border-0" style="background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);">
    <div class="card-body p-0">
        <table class="table table-hover mb-0">
            <thead class="bg-light">
                <tr>
                    <th scope="col" class="px-4">#</th>
                    <th scope="col">Username</th>
                    <th scope="col">Category</th>
                    <th scope="col">Description</th>
                    <th scope="col">Image</th>
                    <th scope="col" class="text-end px-4">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for recipe in recipes %}
                <tr>
                    <th scope="row" class="px-4">{{forloop.counter}}</th>
                    <td class="fw-semibold">{{recipe.recipe_user}}</td>
                    <td class="text-muted">{{recipe.recipe_des|truncatechars:100}}</td>
                    <td class="fw-semibold">{{recipe.recipe_main}}</td>
                    
                    <td>
                        {% if recipe.recipe_image %}
                            <img src="/media/{{recipe.recipe_image}}" class="rounded" style="height: 80px; width: 80px; object-fit: cover;">
                        {% else %}
                            <span class="badge bg-light text-dark">No image</span>
                        {% endif %}
                    </td>
                    <td class="text-end px-4">
                        <a href="#" class="btn btn-outline-danger btn-sm favs" data-recipe-id="{{recipe.id}}">
                            {% if recipe.is_favorite %}❤{% else %}♡{% endif %}
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="text-center py-4">
                        <p class="text-muted mb-0">
                            {% if request.GET.search %}
                                Nothing to show "{{ request.GET.search }}"
                            {% else %}
                                Nothing
                            {% endif %}
                        </p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    /* Previous CSS styles remain the same */
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all favorite buttons
    const favButtons = document.querySelectorAll('.favs');
    
    favButtons.forEach(button => {
        // Add click event listener to each button
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const recipeId = this.dataset.recipeId;
            
            // Send AJAX request
            fetch(`/toggle-favorite/${recipeId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json'
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update button appearance
                    this.innerHTML = data.is_favorite ? '❤' : '♡';
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
});
</script>

{% endblock %}